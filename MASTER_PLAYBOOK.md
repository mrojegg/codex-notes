# MASTER PLAYBOOK: запуск и сопровождение статических сайтов через GitHub Pages

Дата: 2026-02-20
Базовый репозиторий заметок: https://github.com/mrojegg/codex-notes

## 1. Эталонный процесс (от 0 до продакшена)
1. Создать отдельную папку под проект.
2. Подготовить `index.html`.
3. Инициализировать git (`main`).
4. Завести отдельный GitHub-репозиторий под проект.
5. Добавить workflow деплоя GitHub Pages (`.github/workflows/deploy-pages.yml`).
6. Пуш в `main`.
7. В GitHub: `Settings -> Pages -> Source: GitHub Actions`.
8. Проверить успешный run в `Actions`.
9. Купить домен у регистратора.
10. Настроить DNS (A/CNAME).
11. В GitHub Pages указать `Custom domain`.
12. Дождаться `DNS check successful`.
13. Включить `Enforce HTTPS`.
14. Провести финальный smoke-check сайта.

## 2. Безопасный процесс изменений (обязательный)
1. Любая правка только через отдельную ветку (`feature/...`).
2. Локальная проверка перед merge.
3. Merge в `main` только после проверки.
4. Деплой в прод только из `main` через Actions.
5. После релиза делать smoke-check.

## 3. Структура проекта (минимум)
- `index.html` — основной файл.
- `.github/workflows/deploy-pages.yml` — автодеплой.
- `README_DEPLOY.md`/`PROJECT_CHECKLIST.md` — инструкция для повторяемости.

## 4. DNS для GitHub Pages (кастомный домен)
Для apex-домена (`example.ru`):
1. `A @ -> 185.199.108.153`
2. `A @ -> 185.199.109.153`
3. `A @ -> 185.199.110.153`
4. `A @ -> 185.199.111.153`

Для `www`:
1. `CNAME www -> <username>.github.io`

## 5. CAA/SSL (важно)
Если есть проблемы с выпуском SSL, добавить CAA на корень:
1. `CAA @ 0 issue "letsencrypt.org"`
2. `CAA @ 0 issue "digicert.com"`

TXT вроде `_globalsign-domain-verification=...` допустим и обычно не мешает.

## 6. Типовые ошибки и как исправлять
1. Ошибка: `DNS check unsuccessful`.
   - Причина: DNS не применился, делегирование не завершено, неверная зона.
   - Решение: проверить NS, A/CNAME, подождать 15-60 мин (иногда до 24-48 ч), `Check again`.

2. Ошибка: `404 There isn't a GitHub Pages site here`.
   - Причина: Pages не включён/не задеплоен.
   - Решение: `Settings -> Pages -> Source: GitHub Actions`, затем rerun workflow.

3. Ошибка workflow: `Get Pages site failed ... Not Found`.
   - Причина: Pages сервис не активирован в репозитории.
   - Решение: открыть `Settings -> Pages`, сохранить source, rerun jobs.

4. Ошибка push: `refusing to allow PAT ... workflow ... without workflow scope`.
   - Причина: токен без `workflow` scope.
   - Решение: новый PAT с `repo` + `workflow`.

5. Ошибка push: `Invalid username or token`.
   - Причина: просроченный/неверный PAT.
   - Решение: выпустить новый PAT, выполнить push, затем удалить токен из remote URL.

6. Ошибка при просмотре сайта с iPhone через локальный файл (`file://`).
   - Причина: ограничения режима предпросмотра файла.
   - Решение: открывать через `http(s)` (сервер/прод-домен), а не файл.

## 7. Проверки после каждого релиза
1. `https://<domain>` открывается (`200`).
2. `https://www.<domain>` редиректит на основной домен.
3. HTTPS активен, сертификат валиден.
4. Работают ключевые клики/модалки/почта.
5. Мобильная версия кликабельна и читабельна.

## 8. Контентные/функциональные практики, которые отработаны
1. Точечные правки без затрагивания лишнего.
2. Отзывы:
   - убрать лишние подписи,
   - сделать реалистичный объём,
   - добавить кликабельные точки переключения,
   - автопрокрутка с паузой после ручного действия.
3. Контакты:
   - убрать сбор данных, если это требование,
   - оставить только реквизиты/почту,
   - аккуратная компактная модалка.
4. `mailto`:
   - использовать fallback на webmail (mail.ru), если клиент не открылся.

## 9. Безопасность и гигиена
1. Не хранить PAT в git remote.
2. Любой токен, отправленный в чат/лог, считать скомпрометированным и отзывать.
3. Периодически выпускать новые токены с минимально нужными правами.
4. Исключать артефакты сборки из git (`.gitignore`).

## 10. Масштабирование на другие проекты
1. На каждый сайт отдельный репозиторий.
2. Одинаковый процесс деплоя/контроля качества.
3. Использовать шаблонный чеклист в стартовой папке проекта.
4. При потере контекста восстановление через этот playbook + project summary.

## 11. Команды (быстрый набор)
```bash
# обычное обновление прод-сайта
cd /path/to/project
git checkout -b feature/some-change
# ... edits ...
git add .
git commit -m "Update site"
git checkout main
git merge feature/some-change
git push
```

```bash
# если push делали с PAT в URL, вернуть безопасный remote
git remote set-url origin https://github.com/<user>/<repo>.git
```

## 12. Definition of Done (DoD)
Проект считается завершённым, если:
1. Сайт доступен по HTTPS на основном домене.
2. DNS и редиректы работают корректно.
3. Workflow деплоя стабилен и зелёный.
4. Сценарии кликов/форм/почты проверены.
5. Есть чеклист и summary для восстановления контекста.
